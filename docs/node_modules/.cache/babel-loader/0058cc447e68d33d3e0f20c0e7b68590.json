{"ast":null,"code":"import config from\"./config\";import ScatterJS from\"scatterjs-core\";import ScatterEOS from\"scatterjs-plugin-eosjs\";import Eos from\"eosjs\";var account;ScatterJS.plugins(new ScatterEOS());var network=ScatterJS.Network.fromJson({blockchain:\"eos\",chainId:config.chainId,host:config.scatterHost,port:443,protocol:\"https\"});var scatter=ScatterJS.scatter;var eosOptions={expireInSeconds:60};var eos=scatter.eos(network,Eos,eosOptions);var requiredFields={accounts:[network]};ScatterJS.connect(config.gameName,{network:network}).then(function(connected){if(!connected){window.alert(\"Scatter Not Found\");return false;}scatter=ScatterJS.scatter;ScatterJS.login().then(function(){scatter.getIdentity(requiredFields).then(function(){eos=scatter.eos(network,Eos,eosOptions);account=scatter.identity.accounts.find(function(x){return x.blockchain===\"eos\";});// console.log(account);\n});});});function getAccount(){return account;}function eosBet(amount,number,contract,callback){// console.log(number);\nvar actions=[{account:\"eosio.token\",name:\"transfer\",authorization:[{actor:account.name,permission:\"active\"}],// 参数\ndata:{from:account.name,to:contract,quantity:\"\".concat(amount.toFixed(4),\" EOS\"),memo:\"\".concat(number)}}];eos.transaction({actions:actions}).then(function(result){//console.log(result);\ncallback(result);}).catch(function(e){console.error(e);// console.error(typeof e);\nvar response=JSON.parse(e);// console.log(response);\n// console.log(response.code);\n// console.log(response.error);\n// if (response.code === 500) window.alert(response.error.what);\n//response.error.details.\ncallback(response.code);});}function diceBet(amount,number,callback){eosBet(amount,number,config.dice_contract,callback);}function etherollBet(amount,number,callback){eosBet(amount,number,config.etheroll_contract,callback);}function coinBet(amount,number,callback){eosBet(amount,number,config.coin_contract,callback);}function twoBet(amount,number,callback){eosBet(amount,number,config.two_contract,callback);}function endlessBet(amount,number,callback){eosBet(amount,number,config.endless_contract,callback);}function getBalance(callback){if(typeof account===\"undefined\")return;eos.getCurrencyBalance(\"eosio.token\",account.name,\"EOS\").then(function(result){//console.log(result);\ncallback(result);}).catch(function(error){console.error(error);});}function getHistory(start,contract,callback){if(typeof account===\"undefined\")return;if(start<0)start=0;var RECORD_TABLE=\"history\";var tableparam={json:true,code:contract,scope:account.name,table:RECORD_TABLE,limit:100,// index_position: 1,\n// key_type: \"int64\",\nlower_bound:start// upper_bound: end,\n// limit: 10\n};eos.getTableRows(tableparam).then(function(result){// console.log(result);\ncallback(result);}).catch(function(error){console.error(error);});}function getDiceHistory(start,callback){getHistory(start,config.dice_contract,callback);}function getEtherollHistory(start,callback){getHistory(start,config.etheroll_contract,callback);}function getCoinHistory(start,callback){getHistory(start,config.coin_contract,callback);}function getTwoHistory(start,callback){getHistory(start,config.two_contract,callback);}function getHistoryIndex(contract,callback){var RECORD_TABLE=\"result\";var tableparam={json:true,code:contract,scope:account.name,table:RECORD_TABLE,limit:1// index_position: 1,\n// key_type: \"name\",\n// lower_bound: account.name,\n// upper_bound: userName,\n// limit: 10\n};eos.getTableRows(tableparam).then(function(result){// console.log(result);\n// console.log(result.rows[0]);\ncallback(result.rows);}).catch(function(error){console.error(error);});}function getDiceHistoryIndex(callback){getHistoryIndex(config.dice_contract,callback);}function getEtherollHistoryIndex(callback){getHistoryIndex(config.etheroll_contract,callback);}function getCoinHistoryIndex(callback){getHistoryIndex(config.coin_contract,callback);}function getTwoHistoryIndex(callback){getHistoryIndex(config.two_contract,callback);}function getGameStatus(callback){var RECORD_TABLE=\"peroid\";var tableparam={json:true,code:config.endless_contract,scope:config.endless_contract,table:RECORD_TABLE,limit:1};eos.getTableRows(tableparam).then(function(result){callback(result.rows);}).catch(function(error){console.error(error);});}function newGame(callback){var actions=[{account:config.endless_contract,name:\"newgame\",authorization:[{actor:account.name,permission:\"active\"}],// 参数\ndata:{}}];eos.transaction({actions:actions}).then(function(result){callback(result);}).catch(function(e){console.error(e);var response=JSON.parse(e);callback(response.code);});}function rollDice(callback){var actions=[{account:config.endless_contract,name:\"rolldice\",authorization:[{actor:account.name,permission:\"active\"}],// 参数\ndata:{}}];eos.transaction({actions:actions}).then(function(result){callback(result);}).catch(function(e){console.error(e);var response=JSON.parse(e);callback(response.code);});}function getBetList(callback){var RECORD_TABLE=\"bet\";var tableparam={json:true,code:config.endless_contract,scope:config.endless_contract,table:RECORD_TABLE,limit:1000};eos.getTableRows(tableparam).then(function(result){callback(result.rows);}).catch(function(error){console.error(error);});}function getGameResult(callback){var RECORD_TABLE=\"result\";var tableparam={json:true,code:config.endless_contract,scope:config.endless_contract,table:RECORD_TABLE,limit:1};eos.getTableRows(tableparam).then(function(result){callback(result.rows);}).catch(function(error){console.error(error);});}export default{getAccount:getAccount,diceBet:diceBet,etherollBet:etherollBet,coinBet:coinBet,twoBet:twoBet,endlessBet:endlessBet,getDiceHistoryIndex:getDiceHistoryIndex,getEtherollHistoryIndex:getEtherollHistoryIndex,getCoinHistoryIndex:getCoinHistoryIndex,getTwoHistoryIndex:getTwoHistoryIndex,getDiceHistory:getDiceHistory,getEtherollHistory:getEtherollHistory,getCoinHistory:getCoinHistory,getTwoHistory:getTwoHistory,getBalance:getBalance,getGameStatus:getGameStatus,getGameResult:getGameResult,getBetList:getBetList,newGame:newGame,rollDice:rollDice};","map":{"version":3,"sources":["/Users/weihung/Documents/workspace/dice/frontend/dice-demo/src/eos/Scatter.js"],"names":["config","ScatterJS","ScatterEOS","Eos","account","plugins","network","Network","fromJson","blockchain","chainId","host","scatterHost","port","protocol","scatter","eosOptions","expireInSeconds","eos","requiredFields","accounts","connect","gameName","then","connected","window","alert","login","getIdentity","identity","find","x","getAccount","eosBet","amount","number","contract","callback","actions","name","authorization","actor","permission","data","from","to","quantity","toFixed","memo","transaction","result","catch","e","console","error","response","JSON","parse","code","diceBet","dice_contract","etherollBet","etheroll_contract","coinBet","coin_contract","twoBet","two_contract","endlessBet","endless_contract","getBalance","getCurrencyBalance","getHistory","start","RECORD_TABLE","tableparam","json","scope","table","limit","lower_bound","getTableRows","getDiceHistory","getEtherollHistory","getCoinHistory","getTwoHistory","getHistoryIndex","rows","getDiceHistoryIndex","getEtherollHistoryIndex","getCoinHistoryIndex","getTwoHistoryIndex","getGameStatus","newGame","rollDice","getBetList","getGameResult"],"mappings":"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","sourcesContent":["import config from \"./config\";\nimport ScatterJS from \"scatterjs-core\";\nimport ScatterEOS from \"scatterjs-plugin-eosjs\";\nimport Eos from \"eosjs\";\n\nvar account;\n\nScatterJS.plugins(new ScatterEOS());\n\nconst network = ScatterJS.Network.fromJson({\n  blockchain: \"eos\",\n  chainId: config.chainId,\n  host: config.scatterHost,\n  port: 443,\n  protocol: \"https\"\n});\n\nvar scatter = ScatterJS.scatter;\nconst eosOptions = { expireInSeconds: 60 };\nvar eos = scatter.eos(network, Eos, eosOptions);\nconst requiredFields = { accounts: [network] };\n\nScatterJS.connect(config.gameName, { network }).then(connected => {\n  if (!connected) {\n    window.alert(\"Scatter Not Found\");\n    return false;\n  }\n  scatter = ScatterJS.scatter;\n  ScatterJS.login().then(() => {\n    scatter.getIdentity(requiredFields).then(() => {\n      eos = scatter.eos(network, Eos, eosOptions);\n      account = scatter.identity.accounts.find(x => x.blockchain === \"eos\");\n      // console.log(account);\n    });\n  });\n});\n\nfunction getAccount() {\n  return account;\n}\n\nfunction eosBet(amount, number, contract, callback) {\n  // console.log(number);\n  const actions = [\n    {\n      account: \"eosio.token\",\n      name: \"transfer\",\n      authorization: [\n        {\n          actor: account.name,\n          permission: \"active\"\n        }\n      ],\n      // 参数\n      data: {\n        from: account.name,\n        to: contract,\n        quantity: `${amount.toFixed(4)} EOS`,\n        memo: `${number}`\n      }\n    }\n  ];\n  eos\n    .transaction({ actions: actions })\n    .then(result => {\n      //console.log(result);\n      callback(result);\n    })\n    .catch(e => {\n      console.error(e);\n      // console.error(typeof e);\n      const response = JSON.parse(e);\n      // console.log(response);\n      // console.log(response.code);\n      // console.log(response.error);\n      // if (response.code === 500) window.alert(response.error.what);\n      //response.error.details.\n      callback(response.code);\n    });\n}\n\nfunction diceBet(amount, number, callback) {\n  eosBet(amount, number, config.dice_contract, callback);\n}\nfunction etherollBet(amount, number, callback) {\n  eosBet(amount, number, config.etheroll_contract, callback);\n}\nfunction coinBet(amount, number, callback) {\n  eosBet(amount, number, config.coin_contract, callback);\n}\nfunction twoBet(amount, number, callback) {\n  eosBet(amount, number, config.two_contract, callback);\n}\nfunction endlessBet(amount, number, callback) {\n  eosBet(amount, number, config.endless_contract, callback);\n}\n\nfunction getBalance(callback) {\n  if (typeof account === \"undefined\") return;\n  eos\n    .getCurrencyBalance(\"eosio.token\", account.name, \"EOS\")\n    .then(result => {\n      //console.log(result);\n      callback(result);\n    })\n    .catch(error => {\n      console.error(error);\n    });\n}\n\nfunction getHistory(start, contract, callback) {\n  if (typeof account === \"undefined\") return;\n  if (start < 0) start = 0;\n  const RECORD_TABLE = \"history\";\n  const tableparam = {\n    json: true,\n    code: contract,\n    scope: account.name,\n    table: RECORD_TABLE,\n    limit: 100,\n    // index_position: 1,\n    // key_type: \"int64\",\n    lower_bound: start\n    // upper_bound: end,\n    // limit: 10\n  };\n  eos\n    .getTableRows(tableparam)\n    .then(result => {\n      // console.log(result);\n      callback(result);\n    })\n    .catch(error => {\n      console.error(error);\n    });\n}\n\nfunction getDiceHistory(start, callback) {\n  getHistory(start, config.dice_contract, callback);\n}\nfunction getEtherollHistory(start, callback) {\n  getHistory(start, config.etheroll_contract, callback);\n}\nfunction getCoinHistory(start, callback) {\n  getHistory(start, config.coin_contract, callback);\n}\nfunction getTwoHistory(start, callback) {\n  getHistory(start, config.two_contract, callback);\n}\n\nfunction getHistoryIndex(contract, callback) {\n  const RECORD_TABLE = \"result\";\n  const tableparam = {\n    json: true,\n    code: contract,\n    scope: account.name,\n    table: RECORD_TABLE,\n    limit: 1\n    // index_position: 1,\n    // key_type: \"name\",\n    // lower_bound: account.name,\n    // upper_bound: userName,\n    // limit: 10\n  };\n  eos\n    .getTableRows(tableparam)\n    .then(result => {\n      // console.log(result);\n      // console.log(result.rows[0]);\n      callback(result.rows);\n    })\n    .catch(error => {\n      console.error(error);\n    });\n}\nfunction getDiceHistoryIndex(callback) {\n  getHistoryIndex(config.dice_contract, callback);\n}\nfunction getEtherollHistoryIndex(callback) {\n  getHistoryIndex(config.etheroll_contract, callback);\n}\nfunction getCoinHistoryIndex(callback) {\n  getHistoryIndex(config.coin_contract, callback);\n}\nfunction getTwoHistoryIndex(callback) {\n  getHistoryIndex(config.two_contract, callback);\n}\n\nfunction getGameStatus(callback) {\n  const RECORD_TABLE = \"peroid\";\n  const tableparam = {\n    json: true,\n    code: config.endless_contract,\n    scope: config.endless_contract,\n    table: RECORD_TABLE,\n    limit: 1\n  };\n  eos\n    .getTableRows(tableparam)\n    .then(result => {\n      callback(result.rows);\n    })\n    .catch(error => {\n      console.error(error);\n    });\n}\n\nfunction newGame(callback) {\n  const actions = [\n    {\n      account: config.endless_contract,\n      name: \"newgame\",\n      authorization: [\n        {\n          actor: account.name,\n          permission: \"active\"\n        }\n      ],\n      // 参数\n      data: {\n      }\n    }\n  ];\n  eos\n    .transaction({ actions: actions })\n    .then(result => {\n      callback(result);\n    })\n    .catch(e => {\n      console.error(e);\n      const response = JSON.parse(e);\n      callback(response.code);\n    });\n}\n\nfunction rollDice(callback) {\n  const actions = [\n    {\n      account: config.endless_contract,\n      name: \"rolldice\",\n      authorization: [\n        {\n          actor: account.name,\n          permission: \"active\"\n        }\n      ],\n      // 参数\n      data: {\n      }\n    }\n  ];\n  eos\n    .transaction({ actions: actions })\n    .then(result => {\n      callback(result);\n    })\n    .catch(e => {\n      console.error(e);\n      const response = JSON.parse(e);\n      callback(response.code);\n    });\n}\n\nfunction getBetList(callback) {\n  const RECORD_TABLE = \"bet\";\n  const tableparam = {\n    json: true,\n    code: config.endless_contract,\n    scope: config.endless_contract,\n    table: RECORD_TABLE,\n    limit: 1000\n  };\n  eos\n    .getTableRows(tableparam)\n    .then(result => {\n      callback(result.rows);\n    })\n    .catch(error => {\n      console.error(error);\n    });\n}\n\nfunction getGameResult(callback) {\n  const RECORD_TABLE = \"result\";\n  const tableparam = {\n    json: true,\n    code: config.endless_contract,\n    scope: config.endless_contract,\n    table: RECORD_TABLE,\n    limit: 1\n  };\n  eos\n    .getTableRows(tableparam)\n    .then(result => {\n      callback(result.rows);\n    })\n    .catch(error => {\n      console.error(error);\n    });\n}\n\nexport default {\n  getAccount,\n\n  diceBet,\n  etherollBet,\n  coinBet,\n  twoBet,\n  endlessBet,\n\n  getDiceHistoryIndex,\n  getEtherollHistoryIndex,\n  getCoinHistoryIndex,\n  getTwoHistoryIndex,\n\n  getDiceHistory,\n  getEtherollHistory,\n  getCoinHistory,\n  getTwoHistory,\n\n  getBalance,\n\n  getGameStatus,\n  getGameResult,\n  getBetList,\n\n  newGame,\n  rollDice,\n};\n"]},"metadata":{},"sourceType":"module"}